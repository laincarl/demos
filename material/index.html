<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script>
        var addRule = (function(style) {
            var sheet = document.head.appendChild(style).sheet;
            return function(selector, css) {
                var propText = typeof css === "string" ? css : Object.keys(css).map(function(p) {
                    return p + ":" + (p === "content" ? "'" + css[p] + "'" : css[p]);
                }).join(";");
                sheet.insertRule(selector + "{" + propText + "}", sheet.cssRules.length);
            };
        })(document.createElement("style"));

        function deactive(e) {
            console.log('end');
            e.target.classList.remove("material-active");
            e.target.removeEventListener("webkitAnimationEnd", deactive);
        }
        document.addEventListener("mousedown", function(e) {
            if (e.target.classList.contains("material")) {
                var ele = e.target;
                console.log(e.clientX, e.target.getBoundingClientRect().left)
                var left = e.clientX - e.target.getBoundingClientRect().left - e.target.getBoundingClientRect().width / 8;
                var top = e.clientY - e.target.getBoundingClientRect().top - e.target.getBoundingClientRect().height / 8;
                var width = parseInt(Math.max(e.target.getBoundingClientRect().width, e.target.getBoundingClientRect().height) / 4);
                //第一种方法
                e.target.style = "--size:" + width + "px;" + "--top:" + top + "px;" + "--left:" + left + "px;"
                    //第二种方法,insertRule插入已有属性不生效,要加入!important
                    // addRule(".material:after", {
                    //     width: width + 'px!important',
                    //     height: width + 'px!important',
                    //     left: left + 'px!important',
                    //     top: top + 'px!important'
                    // });
                if (e.target.classList.contains("material-active")) {
                    e.target.classList.remove("material-active");
                    setTimeout(function() {
                        e.target.classList.add("material-active");
                    }, 0);
                } else {
                    e.target.classList.add("material-active");
                }
                // console.log(document.styleSheets[0])
                //insertRule插入已有属性不生效,要加入!important
                // document.styleSheets[0].insertRule('.material{ background: green; }', 0);
                // document.styleSheets[0].insertRule('.material{ background: red!important; }', 0);
                e.target.addEventListener("webkitAnimationEnd", deactive);
            }

        })


        function active(e) {

        }
    </script>
    <style>
        .container {
            width: 100px;
            height: 100px;
            border: solid 1px gray;
        }
        
        .material {
            position: relative;
            overflow: hidden;
        }
        
        .material:after {
            content: '';
            height: var(--size, 50%);
            width: var(--size, 50%);
            opacity: 0;
            background: rgba(0, 0, 0, 0.25);
            position: absolute;
            pointer-events: none;
            top: var(--top, 50%);
            left: var(--left, 50%);
            border-radius: 50%;
            /* transform: translateX(-50%) translateY(-50%); */
        }
        
        .material-active:after {
            animation: grow 0.4s linear;
        }
        
        @keyframes grow {
            from {
                opacity: 0;
                transform: scale(1)
            }
            to {
                opacity: 0.7;
                transform: scale(12)
            }
        }
        
        .container2 {
            width: 500px;
            height: 500px;
            border: solid 1px gray;
        }
    </style>
</head>

<body>
    <div class="container material" style="--ttt:38.4px;">

    </div>
    <div class="container2 material" style="--ttt:38.4px;">

    </div>
</body>

</html>