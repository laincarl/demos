<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>仿immer, immutable-js</title>
</head>

<body>
  <figure>
    <figcaption>目标：</figcaption>
    <pre>
      <code>       
        const obj = {
          a: 5,
          b: [1, 2]
        }
        const obj2 = produce(obj, (state) => {
          state.a = 6;
        })
        obj !== obj2
        obj.b === obj2.b
      </code>
    </pre>
  </figure>
  <script>
    // function isProxy(object) {
    //   return object instanceof Proxy;
    // }
    // function makeProxy(object) {
    //   return new Proxy(object, {
    //     get: function (target, propKey, receiver) {
    //       console.log(`getting ${propKey}!`);
    //       return Reflect.get(target, propKey, receiver);
    //     },
    //     set: function (target, propKey, value, receiver) {
    //       console.log(`setting ${propKey}!`);
    //       return Reflect.set(target, propKey, value, receiver);
    //     }
    //   });
    // }
    // function produce(state, fn) {
    //   const proxy = isProxy(state) ? state : makeProxy(state);
    //   return proxy;
    // }
    // const source = {
    //   a: 1,
    //   b: [1, 2, 3]
    // }
    // const result = produce(source, (data) => {
    //   data.a = 2;
    // })
    // console.assert(result !== source, "对象相等");
    // console.assert(result.b === source.b, "子属性不相等");
    function isObject(something) {
      return something instanceof Object;
    }
    function isProxy(something) {
      
    }
    function lazyProxy(object) {
      const proxy = new Proxy(object, {
        get: function (target, propKey, receiver) {
          console.log(`get:${propKey}`, target);
          if (isObject(target[propKey]) && !isProxy(target[propKey])) {
            target[propKey] = lazyProxy(target[propKey])
          }
          return Reflect.get(target, propKey, receiver);
        }
      });
      return proxy
    }
    const proxy = lazyProxy({
      a: 1,
      b: {
        c: 1
      }
    });
    console.log(proxy.b.c)
    console.log(proxy.b.c)
  </script>
</body>

</html>